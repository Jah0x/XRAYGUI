# AGENTS.md

## Описание проекта

**XRAYGUI** — веб-интерфейс для управления и мониторинга Xray (VPN, прокси, безопасность).
Проект построен на **React + TypeScript** (frontend) и использует **Prisma** для работы с базой данных.

---

## Основные файлы и модули

| Файл/Модуль           | Назначение                                                           |
|-----------------------|---------------------------------------------------------------------|
| App.tsx               | Главный компонент приложения, стартовая точка интерфейса            |
| api.ts                | Функции для HTTP-запросов (авторизация, управление, CRUD)           |
| api.test.ts           | Юнит-тесты для api.ts                                               |
| modules/auth.ts         | Функции аутентификации пользователей |
| modules/telegram.ts     | Интеграция Telegram (токены, поиск) |
| modules/subscription.ts | Запросы и статистика подписок |
| modules/admin.ts        | Проверки прав админа и сообщения |
| modules/payments.ts     | Оплата подписок и транзакции |
| modules/offers.ts       | Управление рекламными предложениями |
| schema.prisma         | Схема базы данных Prisma |
| theme.css             | Основные стили интерфейса |
| PRD.md                | Продуктовые требования, описание сценариев использования |
| development-checklist.md | Чеклист и задачи для текущей и будущей разработки |
| RUN.md                | Инструкция по запуску проекта |
| package.json          | Список зависимостей и npm-скриптов |
| .gitignore            | Исключает лишние файлы из репозитория |
| index.html            | Корневой HTML-шаблон для Vite |
| main.tsx              | Точка входа React-приложения, обёртка QueryClientProvider |
| vite.config.ts        | Конфигурация сборщика Vite |
| tsconfig.json         | Настройки TypeScript и алиасов |
| client/api.ts         | Демо-данные и простые методы API для фронтенда |
| client/utils.ts       | Простейшие хуки useAuth/useToast |
| components/ui.tsx     | Минимальные UI-компоненты |
| deploy/nginx.conf     | Пример конфигурации Nginx для продакшена |
| LOGGING.md            | Инструкция по ведению логов проекта |

---

## Журнал разработки и задач

### [2024-06-06]
- Инициализация проекта, добавлены основные модули
- Стартовый UI (App.tsx), структура БД (schema.prisma), API-заготовка

### [2024-06-06] Извлечено из development-checklist.md и PRD.md:
- [ ] Реализовать авторизацию и регистрацию пользователей через API и UI
- [ ] Добавить формы для создания/редактирования пользователей
- [ ] Реализовать страницу просмотра/управления VPN-конфигами
- [ ] Подключить Prisma к реальной базе данных (PostgreSQL)
- [ ] Описать все основные типы данных в отдельном файле types.ts
- [ ] Автоматизировать тестирование (добавить новые тесты, интегрировать CI)
- [ ] Оформить автоматическую генерацию документации по базе через Prisma
- [ ] Реализовать логирование действий пользователей и ошибок
- [ ] Обеспечить обновление журнала разработки и документации при каждом изменении кода
- [ ] Создать страницы: Dashboard, Users, VPN Configs, Settings
- [ ] Доработать стили и добавить темы (theme.css)
- [ ] Описать схему взаимодействия frontend ↔ backend (api.ts)
- [ ] Добавить управление ролями пользователей (админ/юзер)
- [СДЕЛАНО] Настроить .gitignore для исключения node_modules, .env и сессионных файлов
- [ ] Описывать каждый новый модуль/файл в таблице выше и в этом журнале

### [2025-06-06]
- [СДЕЛАНО] Вынесены функции из api.ts в модули auth.ts, telegram.ts и subscription.ts для лучшей модульности
- [НОВАЯ ЗАДАЧА] Перенести остальные API-функции в отдельные файлы

### [2025-06-06]
- [СДЕЛАНО] Удалены неиспользуемые импорты и TOKEN_EXPIRY_HOURS в api.ts
- [СДЕЛАНО] Созданы модули admin.ts, payments.ts и offers.ts
- [СДЕЛАНО] Проверки администратора перенесены в requireAdmin
- [СДЕЛАНО] В ключевых платежных функциях добавлены Prisma-транзакции
- [СДЕЛАНО] Добавлены простые юнит‑тесты для auth, subscription и telegram

### [2025-06-07]
- [СДЕЛАНО] Добавлен файл RUN.md с инструкцией по запуску проекта

### [2025-06-08]
- [СДЕЛАНО] Создан файл package.json с зависимостями и скриптами

### [2025-06-09]
- [СДЕЛАНО] Настроена сборка Vite, добавлены скрипты `dev` и `build`
- [СДЕЛАНО] Созданы файлы `index.html`, `main.tsx`, `vite.config.ts`, `tsconfig.json`
- [СДЕЛАНО] Добавлены простые заглушки для API и UI-компонентов
- [НОВАЯ ЗАДАЧА] Реализовать полноценные UI-компоненты и API-клиент

### [2025-06-10]
- [СДЕЛАНО] Добавлена конфигурация `deploy/nginx.conf`
- [СДЕЛАНО] В `RUN.md` описан процесс сборки и деплоя через Nginx
- [НОВАЯ ЗАДАЧА] Проверить развёртывание на тестовом сервере

### [2025-06-11]
- [СДЕЛАНО] Создан файл `LOGGING.md` с инструкциями по учёту логов
- [СДЕЛАНО] В `RUN.md` добавлен раздел о запуске проекта как службы через Nginx
- [НОВАЯ ЗАДАЧА] Проверить работу логирования и автозапуска на сервере

### [2025-06-12]
- [СДЕЛАНО] В `client/api.ts` добавлены демонстрационные данные для отображения страниц
- [НОВАЯ ЗАДАЧА] Реализовать полноценное подключение к бекенду

### [2025-06-13]
- [СДЕЛАНО] Добавлен параметр `base: './'` в `vite.config.ts` для корректной загрузки
  бандлов без веб‑сервера
- [СДЕЛАНО] Исправлен импорт в `api.test.ts` (`./api.ts`) для совместимости с `ts-node`
- [НОВАЯ ЗАДАЧА] Настроить запуск тестов через `ts-node` с поддержкой ESM

### [2025-06-14]
- [СДЕЛАНО] Обновлена конфигурация `deploy/nginx.conf`: разделены статика и проксирование API
- [СДЕЛАНО] Расширен `LOGGING.md` разделом о логировании сборки
- [НОВАЯ ЗАДАЧА] Проверить вывод логов после нового деплоя

### [2025-06-15]
- [СДЕЛАНО] `main.tsx` обёрнут в `QueryClientProvider`, создан `QueryClient`

---

## Инструкция для Codex/OpenAI

- **Вся новая функциональность и исправления должны вноситься в этот файл!**
- Каждый новый файл, модуль или компонент обязательно описывать в таблице «Основные файлы и модули» и кратко — в журнале задач.
- Любые новые задачи/идеи/баги — сразу записывать отдельными чекбоксами ([ ]), указывать дату и статус.
- **Журнал разработки вести в формате "дата — изменения, задачи, комментарии".**
- Обязательно поддерживать описание всех используемых API и их параметров.
- Автоматически добавлять summary по итогам недели или спринта (что сделано, что осталось).
- Обновлять раздел задач при выполнении/добавлении нового функционала или фиксе багов.

---

## Ссылки

- [GitHub репозиторий XRAYGUI](https://github.com/Jah0x/XRAYGUI)
- [Документация Prisma](https://www.prisma.io/docs)
- [Документация React](https://react.dev/)

---

**Пример ведения журнала:**

```markdown
### [2024-06-08]
- [СДЕЛАНО] Реализована форма регистрации пользователей
- [НОВАЯ ЗАДАЧА] Требуется интеграция backend-авторизации через JWT
- [БАГ] В форме VPN-конфигов не отображаются последние изменения

### [2024-06-09]
- [ ] Добавить unit-тесты для всех новых API
- [ ] Переписать структуру theme.css для поддержки нескольких цветовых схем
