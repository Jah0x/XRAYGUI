# AGENTS.md

## Описание проекта

**XRAYGUI** — веб-интерфейс для управления и мониторинга Xray (VPN, прокси, безопасность).
Проект построен на **React + TypeScript** (frontend) и использует **Prisma** для работы с базой данных.

---

## Основные файлы и модули

| Файл/Модуль           | Назначение                                                           |
|-----------------------|---------------------------------------------------------------------|
| App.tsx               | Главный компонент приложения, стартовая точка интерфейса            |
| api.ts                | Функции для HTTP-запросов (авторизация, управление, CRUD)           |
| api.test.ts           | Юнит-тесты для api.ts                                               |
| modules/auth.ts         | Функции аутентификации пользователей |
| modules/telegram.ts     | Интеграция Telegram (токены, поиск) |
| modules/subscription.ts | Запросы и статистика подписок |
| modules/admin.ts        | Проверки прав админа и сообщения |
| modules/payments.ts     | Оплата подписок и транзакции |
| modules/offers.ts       | Управление рекламными предложениями |
| schema.prisma         | Схема базы данных Prisma |
| theme.css             | Основные стили интерфейса |
| PRD.md                | Продуктовые требования, описание сценариев использования |
| development-checklist.md | Чеклист и задачи для текущей и будущей разработки |
| RUN.md                | Инструкция по запуску проекта |

---

## Журнал разработки и задач

### [2024-06-06]
- Инициализация проекта, добавлены основные модули
- Стартовый UI (App.tsx), структура БД (schema.prisma), API-заготовка

### [2024-06-06] Извлечено из development-checklist.md и PRD.md:
- [ ] Реализовать авторизацию и регистрацию пользователей через API и UI
- [ ] Добавить формы для создания/редактирования пользователей
- [ ] Реализовать страницу просмотра/управления VPN-конфигами
- [ ] Подключить Prisma к реальной базе данных (PostgreSQL)
- [ ] Описать все основные типы данных в отдельном файле types.ts
- [ ] Автоматизировать тестирование (добавить новые тесты, интегрировать CI)
- [ ] Оформить автоматическую генерацию документации по базе через Prisma
- [ ] Реализовать логирование действий пользователей и ошибок
- [ ] Обеспечить обновление журнала разработки и документации при каждом изменении кода
- [ ] Создать страницы: Dashboard, Users, VPN Configs, Settings
- [ ] Доработать стили и добавить темы (theme.css)
- [ ] Описать схему взаимодействия frontend ↔ backend (api.ts)
- [ ] Добавить управление ролями пользователей (админ/юзер)
- [ ] Настроить .gitignore для исключения node_modules, .env и сессионных файлов
- [ ] Описывать каждый новый модуль/файл в таблице выше и в этом журнале

### [2025-06-06]
- [СДЕЛАНО] Вынесены функции из api.ts в модули auth.ts, telegram.ts и subscription.ts для лучшей модульности
- [НОВАЯ ЗАДАЧА] Перенести остальные API-функции в отдельные файлы

### [2025-06-06]
- [СДЕЛАНО] Удалены неиспользуемые импорты и TOKEN_EXPIRY_HOURS в api.ts
- [СДЕЛАНО] Созданы модули admin.ts, payments.ts и offers.ts
- [СДЕЛАНО] Проверки администратора перенесены в requireAdmin
- [СДЕЛАНО] В ключевых платежных функциях добавлены Prisma-транзакции
- [СДЕЛАНО] Добавлены простые юнит‑тесты для auth, subscription и telegram

### [2025-06-07]
- [СДЕЛАНО] Добавлен файл RUN.md с инструкцией по запуску проекта

---

## Инструкция для Codex/OpenAI

- **Вся новая функциональность и исправления должны вноситься в этот файл!**
- Каждый новый файл, модуль или компонент обязательно описывать в таблице «Основные файлы и модули» и кратко — в журнале задач.
- Любые новые задачи/идеи/баги — сразу записывать отдельными чекбоксами ([ ]), указывать дату и статус.
- **Журнал разработки вести в формате "дата — изменения, задачи, комментарии".**
- Обязательно поддерживать описание всех используемых API и их параметров.
- Автоматически добавлять summary по итогам недели или спринта (что сделано, что осталось).
- Обновлять раздел задач при выполнении/добавлении нового функционала или фиксе багов.

---

## Ссылки

- [GitHub репозиторий XRAYGUI](https://github.com/Jah0x/XRAYGUI)
- [Документация Prisma](https://www.prisma.io/docs)
- [Документация React](https://react.dev/)

---

**Пример ведения журнала:**

```markdown
### [2024-06-08]
- [СДЕЛАНО] Реализована форма регистрации пользователей
- [НОВАЯ ЗАДАЧА] Требуется интеграция backend-авторизации через JWT
- [БАГ] В форме VPN-конфигов не отображаются последние изменения

### [2024-06-09]
- [ ] Добавить unit-тесты для всех новых API
- [ ] Переписать структуру theme.css для поддержки нескольких цветовых схем
